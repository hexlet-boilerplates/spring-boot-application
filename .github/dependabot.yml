---
# Dependabot configuration
#
# This file configures automated dependency updates for a Java/Gradle project
# that uses a Gradle Version Catalog (libs.versions.toml).
#
# Goals:
#  - keep Gradle dependencies (libraries + plugins) up to date without PR noise
#  - keep GitHub Actions workflows up to date in a separate group
#  - batch minor and patch updates into a few focused PRs
#  - keep potentially breaking (major) updates visible as separate PRs
#
# How grouping is used here:
#  - Gradle plugins (Spring Boot, Lombok, Spotless, Sonar, Shadow, Versions)
#    are grouped together so build tooling updates come in a single PR.
#  - Spring Boot runtime dependencies are grouped together
#    so framework updates are reviewed as one coherent change.
#  - OpenAPI / Jackson Nullable, DB, testing libraries, and commons utilities
#    get their own groups for easier review.
#  - A "catch-all" group collects any remaining Gradle dependencies
#    for minor/patch updates.
#
# Recommended documentation:
#
# 1) Dependabot Options Reference — full list of available keys,
#    including "groups", "patterns", "update-types", etc.
#    https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file
#
# 2) Optimizing pull request creation — best practices for grouping updates,
#    controlling frequency, and limiting noise in development teams.
#    https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/optimizing-pr-creation-version-updates
#
# Notes for Gradle + Version Catalog:
#  - Dependabot understands Gradle Version Catalogs and will update versions
#    defined under [versions], [libraries], and [plugins] in libs.versions.toml.
#  - Group "patterns" match the resolved dependency name, typically
#    "groupId:artifactId" for libraries or the plugin id for Gradle plugins.
#  - Any outdated dependencies that do not match a group rule will be
#    updated in individual PRs (typically major updates in this setup).
#
version: 2
updates:
  # 1) Keep GitHub Actions workflows up to date
  - package-ecosystem: github-actions
    directory: /  # Look for workflow files in the repo root
    schedule:
      interval: weekly  # Check for updates once a week
    labels: [dependencies, automated, actions]
    groups:
      actions-minor-patch:
        # Group all non-breaking (minor + patch) updates into a single PR
        update-types: [minor, patch]
      actions-major:
        # Major updates are potentially breaking → separate PRs
        update-types: [major]
  # 2) Java / Gradle dependencies (libraries + plugins, including version catalog)
  - package-ecosystem: gradle
    directory: /  # Root of the Gradle project (build.gradle.kts, libs.versions.toml)
    schedule:
      interval: weekly
    labels: [dependencies, automated, gradle]
    groups:
      gradle-plugins-minor-patch:
        # Gradle plugins from [plugins] in libs.versions.toml:
        #  - org.springframework.boot
        #  - io.spring.dependency-management
        #  - io.freefair.lombok
        #  - com.github.ben-manes.versions
        #  - com.gradleup.shadow
        #  - org.sonarqube
        #  - com.diffplug.spotless
        patterns:
          - org.springframework.boot
          - io.spring.dependency-management
          - io.freefair.lombok
          - com.github.ben-manes.versions
          - com.gradleup.shadow
          - org.sonarqube
          - com.diffplug.spotless
        update-types: [minor, patch]
      spring-runtime-minor-patch:
        # Spring Boot application dependencies
        # (spring-boot-starter-webmvc, data-jpa, validation, actuator, security,
        #  devtools, configuration-processor, etc.)
        patterns: [org.springframework.boot:*]
        update-types: [minor, patch]
      openapi-and-nullable-minor-patch:
        # OpenAPI + Jackson nullable integrations
        #  - org.springdoc:springdoc-openapi-starter-webmvc-ui
        #  - org.openapitools:jackson-databind-nullable
        patterns: [org.springdoc:*, org.openapitools:jackson-databind-nullable]
        update-types: [minor, patch]
      db-minor-patch:
        # Database runtime dependencies (H2 in this project)
        patterns: [com.h2database:h2]
        update-types: [minor, patch]
      tests-and-test-utils-minor-patch:
        # Testing stack:
        #  - JUnit BOM + Jupiter + Platform
        #  - Spring Boot test starters
        #  - DataFaker, Instancio, JSON Unit
        patterns:
          - org.junit:*
          - org.junit.jupiter:*
          - org.junit.platform:*
          - org.springframework.boot:spring-boot-starter-test
          - org.springframework.boot:spring-boot-starter-webmvc-test
          - net.datafaker:*
          - org.instancio:*
          - net.javacrumbs.json-unit:*
        update-types: [minor, patch]
      commons-and-utils-minor-patch:
        # General-purpose utility libraries:
        #  - org.apache.commons:commons-lang3
        #  - org.apache.commons:commons-collections4
        patterns: [org.apache.commons:*]
        update-types: [minor, patch]
      mapping-and-codegen-minor-patch:
        # Mapping / codegen helpers:
        #  - org.mapstruct:mapstruct
        #  - org.mapstruct:mapstruct-processor
        patterns: [org.mapstruct:*]
        update-types: [minor, patch]
      other-gradle-minor-patch:
        # Catch-all for any other Gradle dependencies that:
        #  - are not matched by the patterns above
        #  - and are minor/patch updates
        #
        # This keeps the number of PRs low while still separating concerns
        # into meaningful groups.
        update-types: [minor, patch]
        # Note: Major updates that do not match any group rule
        # will be opened as separate PRs by default.
